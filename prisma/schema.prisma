datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Rank {
  ADMIN
  BARK_VERIFIED
  BARK_TEAL
  MEMBER
}

model User {
  id       Int    @id @default(autoincrement())
  username String @unique
  email    String @unique

  rank Rank @default(MEMBER)

  profilePic String?
  bio        String  @default("")
  banner     String?

  likes Like[]
  posts Post[]

  following User[] @relation("Follows")
  followers User[] @relation("Follows")

  blocked   User[] @relation("Blocks")
  blockedBy User[] @relation("Blocks")
}

model Post {
  id    String @id
  post  String @db.VarChar(3000)
  media Json

  likes  Like[]
  user   User   @relation(fields: [userId], references: [id])
  userId Int

  replies   Post[]  @relation("ReplyTo")
  replyTo   Post?   @relation("ReplyTo", fields: [replyToId], references: [id])
  replyToId String?
}

model Like {
  post   Post   @relation(fields: [postId], references: [id])
  postId String

  user   User @relation(fields: [userId], references: [id])
  userId Int

  @@id([postId, userId])
}
